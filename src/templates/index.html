{% extends "layout.html" %} {% block title %} BibTex -lähdehallintatyökalu {%
endblock %} {% block body %}

<div id="messages">
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, message in messages %} {% if category in
    ["error", "success"] %}
    <div class="message {{ category }}">{{ message }}</div>
    {% endif %} {% endfor %} {% endif %} {% endwith %}
</div>

<div id="books">
    <div class="source-list">
        {% for source in sources %}
        <div class="source">
            <div class="info">
                <div class="top-row">
                    <div class="title">{{ source.title }}</div>
                    <div class="key">{{ source.bibtex_key }}</div>
                </div>
                <div class="author">{{ source.author }}</div>
                <div class="year">{{ source.year }}</div>
                <form
                    action="{{ url_for('delete_source', source_id=source.source_id) }}"
                    method="POST"
                    onsubmit="return confirmDelete();"
                >
                    <button type="submit" id="delete-source-btn">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </form>
            </div>
        </div>
        {% else %}
        <div class="text-disabled">Ei lähteitä.</div>
        {% endfor %}
    </div>
</div>

<button id="add-source-btn" class="circle" title="Lisää lähde">
    <i class="fa-solid fa-plus"></i>
</button>

<form
    action="/"
    method="POST"
    id="add-source-form"
    class="{% if show_add_form %}show{% endif %}"
>
    <div class="inner">
        <div class="top-row">
            <h2>Lisää lähde</h2>
            <button class="close" type="button">
                <i class="fa-solid fa-x"></i>
            </button>
        </div>

        <div class="content">
            <label for="add-field-type">Tyyppi</label>
            <select name="type" id="add-field-type">
                <option value="book">Kirja</option>
                <option value="article">Artikkeli</option>
            </select>

            <div id="add-form-fields"></div>

            <button type="submit" id="source-form-btn" class="btn primary">
                Lisää
            </button>
        </div>
    </div>
</form>

<script>
    formFields = JSON.parse(`{{form_json|safe}}`);

    function confirmDelete() {
        return confirm('Poistetaanko lähde?');
    }
</script>
<script src="{{ url_for('static',filename='index.js') }}"></script>

{% endblock %}
